<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Отзывы</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 100%;
            margin: 20px auto;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 12px;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
            font-weight: 600;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
        }
        .rating-stats {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 0.9em;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards 0.2s;
        }
        .rating-stats-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }
        .rating-stats-title-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        .rating-stats-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin-left: 5px;
            white-space: nowrap;
        }
        .telegram-icon {
            color: #0088cc;
            font-size: 1.2em;
            text-decoration: none;
            margin-right: 5px;
            flex-shrink: 0;
        }
        .rating-summary {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 5px;
        }
        .rating-stars {
            color: #ffc107;
        }
        .rating-count {
            color: #6c757d;
            margin-bottom: 10px;
        }
        .rating-bars {
            max-width: 200px;
            margin: 0 auto;
        }
        .rating-bar {
            display: flex;
            align-items: center;
            margin-bottom: 3px;
            font-size: 0.8em;
        }
        .rating-bar-label {
            width: 20px;
            text-align: right;
            margin-right: 5px;
        }
        .rating-bar-outer {
            flex-grow: 1;
            background-color: #e9ecef;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
        }
        .rating-bar-inner {
            height: 100%;
            background-color: #4a4a4a;
            width: 0;
            transition: width 0.5s ease;
        }
        .rating-bar-percent {
            width: 30px;
            text-align: left;
            margin-left: 5px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin: 20px 0 15px;
            font-size: 1.2em;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards 0.4s;
        }
        #citySearch {
            width: 100%;
            margin-bottom: 30px;
            padding: 10px 15px;
            font-size: 16px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-sizing: border-box;
        }
        #cityList {
            list-style-type: none;
            padding: 0;
            margin: 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ced4da;
            border-radius: 8px;
            display: none;
        }
        #cityList li {
            padding: 10px 15px;
            cursor: pointer;
        }
        #cityList li:hover {
            background-color: #f8f9fa;
        }
        .review {
            border-bottom: 1px solid #e0e0e0;
            padding: 25px 0;
            margin-bottom: 25px;
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease forwards;
        }
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .user-info {
            display: flex;
            align-items: center;
        }
        .username {
            font-weight: 500;
            color: #333;
            margin: 0 10px;
            font-size: 1.1em;
        }
        .date-rating {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        .date {
            color: #6c757d;
            font-size: 0.9em;
        }
        .rating {
            background-color: #333;
            color: white;
            padding: 3px 8px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .review-content {
            margin-top: 10px;
            font-size: 1.1em;
            line-height: 1.8;
        }
        .representative-response {
            background-color: #f8f9fa;
            padding: 20px;
            margin-top: 20px;
            border-radius: 8px;
            border-left: 4px solid #333;
        }
        .dispute-label {
            color: #dc3545;
            font-weight: 500;
            margin-top: 10px;
            display: inline-block;
            padding: 5px 10px;
            background-color: #fff3f3;
            border-radius: 4px;
        }
        .thumbnail {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-top: 10px;
        }
        .full-img {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .full-img.show {
            opacity: 1;
        }
        .full-img img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
        .fa-user, .fa-telegram {
            color: #333;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeInUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            h1 {
                font-size: 1.5em;
            }
            .rating-stats-title {
                font-size: 1em;
            }
            .rating-summary {
                font-size: 1.2em;
            }
            .review {
                padding: 15px 0;
            }
            .review-content {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Отзывы</h1>
        <div class="rating-stats">
            <div class="rating-stats-header">
                <div class="rating-stats-title-wrapper">
                    <a href="https://t.me/WorkGCGgbot" class="telegram-icon" target="_blank">
                        <i class="fab fa-telegram"></i>
                    </a>
                    <div class="rating-stats-title">@WorkGCGgbot</div>
                </div>
            </div>
            <div class="rating-summary">
                4.99 <span class="rating-stars">★★★★★</span>
            </div>
            <p class="rating-count">Оценило 9000+ человек</p>
            <div class="rating-bars">
                <div class="rating-bar">
                    <span class="rating-bar-label">5★</span>
                    <div class="rating-bar-outer">
                        <div class="rating-bar-inner" style="width: 0%;"></div>
                    </div>
                    <span class="rating-bar-percent">98%</span>
                </div>
                <div class="rating-bar">
                    <span class="rating-bar-label">4★</span>
                    <div class="rating-bar-outer">
                        <div class="rating-bar-inner" style="width: 0%;"></div>
                    </div>
                    <span class="rating-bar-percent">1%</span>
                </div>
                <div class="rating-bar">
                    <span class="rating-bar-label">3★</span>
                    <div class="rating-bar-outer">
                        <div class="rating-bar-inner" style="width: 0%;"></div>
                    </div>
                    <span class="rating-bar-percent">0%</span>
                </div>
                <div class="rating-bar">
                    <span class="rating-bar-label">2★</span>
                    <div class="rating-bar-outer">
                        <div class="rating-bar-inner" style="width: 0%;"></div>
                    </div>
                    <span class="rating-bar-percent">0%</span>
                </div>
                <div class="rating-bar">
                    <span class="rating-bar-label">1★</span>
                    <div class="rating-bar-outer">
                        <div class="rating-bar-inner" style="width: 0%;"></div>
                    </div>
                    <span class="rating-bar-percent">1%</span>
                </div>
            </div>
        </div>
        <input type="text" id="citySearch" placeholder="Введите название города...">
        <ul id="cityList"></ul>
        <div id="reviewsContainer"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const jsonFileUrl = 'https://qkefkfgk.github.io/egwegweg/data.json';
        const cities = ["Адлер", "Азов", "Аксай", "Анапа", "Ангарск", "Армавир", "Афипский", "Ачинск", "Балаково", "Батайск", "Белореченск", "Биробиджан", "Благовещенск", "Владикавказ", "Волгодонск", "Волжский", "Вологда", "Гданьск", "Геленджик", "Дербент", "Динская (станица)", "Донецк", "Ейск", "Екатеринбург", "Екатерининская", "Зверево", "Зеленодольск", "Ивановская", "Избербаш", "Иркутск", "Казань", "Калининград", "Каспийск", "Кемерово", "Керчь", "Кизляр", "Колпино", "Копейск", "Кострома", "Краснодар", "Красный сулин", "Кущёвская (станица)", "Луганск", "Махачкала", "Минусинск", "Михайловск", "Моздок", "Москва", "Назрань", "Нальчик", "Невинномысск", "Новая Адыгея", "Новосибирск", "Новочеркасск", "Омск", "Оренбург", "Пермь", "Прохладный", "Пятигорск", "Ростов", "Ростов-на-Дону", "Салехард", "Сальск", "Самара", "Санкт-Петербург", "Саранск", "Саратов", "Светлоград", "Симферополь", "Славянск-на-Кубани", "Сочи", "Ставрополь", "Стерлитамак", "Таганрог", "Тамбов", "Тверь", "Тимашевск", "Тихорецк", "Томск", "Тюмень", "Усолье-Сибирское", "Усть-Илимск", "Устье (Псковская область)", "Устье (Устьянский район)", "Уфа", "Хасавюрт", "Челябинск", "Черемхово", "Черкесск", "Чита", "Чунский", "Шахты", "Якутск", "Ярославль"];

        $(document).ready(function() {
            const citySearch = $('#citySearch');
            const cityList = $('#cityList');

            citySearch.on('input', function() {
                const searchTerm = $(this).val().toLowerCase();
                const filteredCities = cities.filter(city => city.toLowerCase().includes(searchTerm));
                
                cityList.empty();
                if (filteredCities.length > 0 && searchTerm.length > 0) {
                    filteredCities.forEach(city => {
                        cityList.append(`<li>${city}</li>`);
                    });
                    cityList.show();
                } else {
                    cityList.hide();
                }
            });

            cityList.on('click', 'li', function() {
                const selectedCity = $(this).text();
                citySearch.val(selectedCity);
                cityList.hide();
                fetchReviews(selectedCity);
            });

            $(document).on('click', function(e) {
                if (!$(e.target).closest('#citySearch, #cityList').length) {
                    cityList.hide();
                }
            });

            // Анимация рейтинговых полос
            setTimeout(() => {
                $('.rating-bar-inner').each(function() {
                    $(this).css('width', $(this).parent().next().text());
                });
            }, 500);

            function fetchReviews(selectedCity) {
                fetch(jsonFileUrl)
                    .then(response => response.text())
                    .then(text => {
                        console.log("Raw response:", text);
                        return JSON.parse(text);
                    })
                    .then(data => {
                        const filteredReviews = data.filter(item => item.city === selectedCity);
                        displayReviews(filteredReviews);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        $('#reviewsContainer').html('<p>В данном городе отзывы скрыты в целях безопасности. Выберите другой город.</p>');
                    });
            }

            function displayReviews(reviews) {
                const container = $('#reviewsContainer');
                container.empty();

                const currentDate = new Date();

                const filteredReviews = reviews
                    .filter(review => {
                        const reviewDate = parseDate(review.date);
                        return reviewDate <= currentDate;
                    })
                    .sort((a, b) => {
                        const dateA = parseDate(a.date);
                        const dateB = parseDate(b.date);
                        return dateB - dateA;
                    });

                filteredReviews.forEach((review, index) => {
                    const reviewElement = $(`
                        <div class="review" style="animation-delay: ${index * 0.1}s;">
                            <div class="review-header">
                                <div class="user-info">
                                    <i class="fas fa-user"></i>
                                    <span class="username">${review.username}</span>
                                    <i class="fab fa-telegram"></i>
                                </div>
                                <div class="date-rating">
                                    <span class="date">${review.date}</span>
                                    <span class="rating">${review.rating}</span>
                                </div>
                            </div>
                            <div class="review-content">${review.review}</div>
                            ${review.photo ? `<img src="${review.photo}" alt="Фото отзыва" class="thumbnail">` : ''}
                            ${review.representativeResponse ? `
                                <div class="representative-response">
                                    <strong>Ответ:</strong> ${review.representativeResponse}
                                </div>
                            ` : ''}
                            ${review.isDispute ? '<p class="dispute-label">Спорный отзыв</p>' : ''}
                        </div>
                    `);

                    container.append(reviewElement);
                });

                $('.thumbnail').on('click', function() {
                    const fullImg = $('<div class="full-img"><img src="' + $(this).attr('src') + '"></div>');
                    $('body').append(fullImg);
                    setTimeout(() => fullImg.addClass('show'), 50);
                    fullImg.on('click', function() {
                        $(this).removeClass('show');
                        setTimeout(() => $(this).remove(), 300);
                    });
                });
            }

            function parseDate(dateString) {
                const [datePart, timePart] = dateString.split(' ');
                const [day, month, year] = datePart.split('/');
                const [hour, minute] = timePart.split(':');
                return new Date(2000 + parseInt(year), month - 1, day, hour, minute);
            }
        });
    </script>
</body>
</html>
